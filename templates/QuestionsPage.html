<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAB</title>
    <link rel="stylesheet" href="../static/CSS/QuestionsPage.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>

    <div class="loading" id="loading">
            
        <div class="loading_centered">
            <img src="../static/assets/image/logo.png" alt="logo">
            <p>
            Generating...
            </p>
        </div>
    </div>

    <video id="bg-vid" autoplay loop muted>
        <source src="../static/assets/video/grid.mp4" type="video/mp4">
    </video>

    <div class="navbar">
        <img src="../static/assets/image/logo.png" alt="logo">
        <a href="{{ url_for('questions') }}"><i class='bx bxs-home bx-lg'></i></a>
        <a href="{{ url_for('profile') }}"><i class='bx bxs-user bx-lg'></i></a>
    </div>

    <div class="wrapper">

        <form id="question-form" action="/cards" method="POST">
            <h1 id="question-title">Question 1</h1>

            <!-- Question container -->
            <div class="input-box">
                <p id="random-question" style="font-weight: bold;"></p>
                <input type="text" id="answer" placeholder="Your answer" required>
            </div>

            <!-- Navigation buttons -->
            <div class="button-container">
                <div class="cancel-button">
                    <button type="button" onclick="navigateQuestion('prev')">Previous</button>
                </div>
                <div class="next-button">
                    <button type="button" onclick="navigateQuestion('next')">Next</button>
                </div>
            </div>

            <!-- Submit button -->
            <div class="submit-container" style="display: none;">
                <button type="submit" onclick="showLoadingScreen()">Submit</button>
            </div>

            <!-- Hidden inputs for all answers -->
            <input type="hidden" name="questions_and_answers" id="questions-and-answers">
        </form>
    </div>

    <div class="instructions" id="instruc-div">
        <h1>WELCOME</h1>

        <p>
            Welcome to our Build-a-Baffle! 
            
                Here’s how it works:

You’ll be asked three simple questions, one at a time. All you need to do is answer each question with the first thing that comes to your mind—no overthinking!

To begin, click the "Start" button. The first question will appear on your screen. Type your answer in the box provided and either click "Next" or press "Enter" to move on.

After answering all three questions, click "Submit" to finish. A confirmation message will let you know your responses have been recorded.

Once you’re done, you might see a summary of your answers or be guided to the next part of the experience. If you want to try again, just click the "Retake" button to start over.

Enjoy the activity!
        </p>

        <button onclick="closeInstruction()">OK!</button>
    </div>



    <script>


        // Instructions button 
        function closeInstruction() {
            const instructDiv = document.getElementById('instruc-div');
            instructDiv.classList.add('move-up');
        }









        // Initialize necessary variables
        let currentQuestion = 1;
        const totalQuestions = 3;
        const questions = [
            "What's one thing you'd like to achieve this year?",
            "What's something you want to improve about yourself?",
            "What’s the biggest challenge you’ve faced recently?",
            "Can you think of a time when you pushed through something difficult?",
            "What’s one change you’d like to see in your community?",
            "If you could help someone right now, who would it be and how?",
            "If you could create a new habit for yourself, what would it be?",
            "What’s an idea you’ve always wanted to try but haven’t yet?",
            "How would you help someone who’s struggling with a problem?",
            "What’s one thing you’d do if you were the leader of a team?"
        ];
        const randomQuestions = [];
        const answers = []; // Array to store answers

        // Generate random questions
        function generateRandomQuestions() {
            while (randomQuestions.length < totalQuestions) {
                const randomIndex = Math.floor(Math.random() * questions.length);
                const question = questions[randomIndex];
                if (!randomQuestions.includes(question)) {
                    randomQuestions.push(question);
                }
            }
        }

        // Update the question display
        function updateQuestion() {
            if (randomQuestions.length > 0) {
                document.getElementById('random-question').textContent = randomQuestions[currentQuestion - 1];
                document.getElementById('question-title').textContent = `Question ${currentQuestion}`;
                document.getElementById('answer').value = answers[currentQuestion - 1] || ''; // Load saved answer
            }
        }

        // Navigate between questions
        function navigateQuestion(direction) {
            const answerInput = document.getElementById('answer');
            answers[currentQuestion - 1] = answerInput.value; // Save current answer

            if (direction === 'next' && currentQuestion < totalQuestions) {
                currentQuestion++;
            } else if (direction === 'prev' && currentQuestion > 1) {
                currentQuestion--;
            }

            updateQuestion();

            // Toggle navigation buttons
            document.querySelector('.button-container').style.display = currentQuestion === totalQuestions ? 'none' : 'flex';
            document.querySelector('.submit-container').style.display = currentQuestion === totalQuestions ? 'block' : 'none';
        }

        // Show loading screen
        function showLoadingScreen() {
            document.getElementById('loading').style.display = 'block';
        }


        document.getElementById('question-form').addEventListener('submit', function (event) {
            // Show loading animation
            document.getElementById('loading').style.display = 'block';

            // Save answers and questions
            const answerInput = document.getElementById('answer');
            answers[currentQuestion - 1] = answerInput.value.trim() || ''; // Save current answer

            const questionsAndAnswers = randomQuestions.map((question, index) => ({
                question,
                answer: answers[index] || ''
            }));

            console.log("Questions and Answers before submission:", questionsAndAnswers);

            // Store as JSON in the hidden input
            document.getElementById('questions-and-answers').value = JSON.stringify(questionsAndAnswers);
        });

        // Initialize random questions
        generateRandomQuestions();
        updateQuestion();

    </script>
</body>

</html>
