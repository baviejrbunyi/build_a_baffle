<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAB</title>
    <link rel="stylesheet" href="../static/CSS/CardPage.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>

    <video id="bg-vid" autoplay loop muted>
        <source src="../static/assets/video/grid.mp4" type="video/mp4">
    </video>

    <div class="navbar">
        <img src="../static/assets/image/logo.png" alt="logo">
        <a href="{{ url_for('questions') }}"><i class='bx bxs-home bx-lg'></i></a>
        <a href="{{ url_for('profile') }}"><i class='bx bxs-user bx-lg'></i></a>


    </div>

    <div class="card-container">
        {% for baffle in baffles %}
        <div class="card" data-title="{{ baffle.title }}" data-field="{{ baffle.field|join(', ') }}"
            data-gaps="{{ baffle.gaps|join(', ') }}" data-recommendations="{{ baffle.recommendations }}"
            onclick="handleCardClick(this)">
            <p>{{ baffle.title }}</p>
        </div>
        {% endfor %}
    </div>

    <div class="selected-card" id="target-div" style="display: none;">
        <button onclick="hideTargetDiv()">X</button>

        <div class="selected-text">
            <h2 id="selected-title"></h2>
            <p id="selected-field"></p>
            <p id="selected-gaps"></p>
            <p id="selected-recommendations"></p>
        </div>

        <div class="selected-buttons">
            <button id="regenerate-button">Regenerate</button>
            <button id="bookmark-button" onclick="showConfirmDiv()">Bookmark</button>
        </div>
    </div>

    <div class="bookmark-confirm" id="confirm-div" style="display: none;">
        <p>Add to bookmark?</p>

        <div class="confirm-buttons">
            <button id="confirm-yes" onclick="">Yes</button>
            <button id="confirm-no" onclick="hideConfirmDiv()">No</button>
        </div>
    </div>

    <script>
        // Handle card click
        function handleCardClick(card) {
            const title = card.getAttribute('data-title');
            const field = card.getAttribute('data-field');
            const gaps = card.getAttribute('data-gaps');
            const recommendations = card.getAttribute('data-recommendations');

            // Update selected card content
            document.getElementById('selected-title').textContent = `Title: ${title}`;
            document.getElementById('selected-field').textContent = `Field(s): ${field}`;
            document.getElementById('selected-gaps').textContent = `Gaps: ${gaps}`;
            document.getElementById('selected-recommendations').textContent = `Recommendations: ${recommendations}`;

            // Show the selected card
            const targetDiv = document.getElementById('target-div');
            targetDiv.style.display = 'block';
        }

        // Hide the selected card
        function hideTargetDiv() {
            const targetDiv = document.getElementById('target-div');
            targetDiv.style.display = 'none';
        }

        // Show the bookmark confirmation dialog
        function showConfirmDiv() {
            const confirmDiv = document.getElementById('confirm-div');
            confirmDiv.style.display = 'block';
        }

        // Hide the bookmark confirmation dialog
        function hideConfirmDiv() {
            const confirmDiv = document.getElementById('confirm-div');
            confirmDiv.style.display = 'none';
        }

        document.getElementById('regenerate-button').addEventListener('click', function () {
            const field = document.getElementById('selected-field').textContent.replace("Field(s): ", "");

            fetch('/regenerate_baffle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ field: field })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`Error: ${data.error}`);
                    } else {
                        // Update the selected card with new baffle data
                        document.getElementById('selected-title').textContent = `Title: ${data.title}`;
                        document.getElementById('selected-field').textContent = `Field(s): ${data.field}`;
                        document.getElementById('selected-gaps').textContent = `Gaps: ${data.gaps}`;
                        document.getElementById('selected-recommendations').textContent = `Recommendations: ${data.recommendations}`;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to regenerate baffle');
                });
        });

    </script>

</body>

</html>